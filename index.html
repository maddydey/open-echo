<script>
// –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–ï–í–†–ê–©–ï–ù–ò–Ø –¢–ï–ö–°–¢–ê –í –ö–õ–ò–ö–ê–ë–ï–õ–¨–ù–´–ï –°–°–´–õ–ö–ò
function linkify(text) {
    if (!text) return "";
    const urlPattern = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
    return text.replace(urlPattern, function(url) {
        return `<a href="${url}" target="_blank" style="color:var(--accent); text-decoration: underline;">${url}</a>`;
    });
}

// –û–ë–ù–û–í–õ–ï–ù–ù–´–ô RENDER (–í–°–¢–ê–í–¨ –≠–¢–û –í–ù–£–¢–†–¨ –°–í–û–ï–ô –§–£–ù–ö–¶–ò–ò RENDER)
function render(data) {
    const feed = document.getElementById('feed');
    feed.innerHTML = '';
    if (!data) return;
    
    const mainPosts = data.filter(p => !p.parent_id);
    const replies = data.filter(p => p.parent_id);

    mainPosts.forEach(post => {
        const container = document.createElement('div');
        container.className = 'post-container';
        // –ò–°–ü–û–õ–¨–ó–£–ï–ú linkify –î–õ–Ø –ö–û–ù–¢–ï–ù–¢–ê
        const contentWithLinks = linkify(post.content);
        
        container.innerHTML = `
            <div class="post-card">
                <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
                    <div class="avatar">${post.avatar_url ? `<img src="${post.avatar_url}">` : ''}</div>
                    <div style="font-weight:700; font-size:15px;">@${post.username}</div>
                    ${post.user_id === myId ? `<span onclick="del('${post.id}')" style="margin-left:auto; opacity:0.3; font-size:16px;">‚úï</span>` : ''}
                </div>
                <div style="font-size:16px; line-height:1.4; color:rgba(255,255,255,0.9);">${contentWithLinks}</div>
                ${post.image_url ? `<img src="${post.image_url}" class="post-image">` : ''}
                <div style="margin-top:15px; opacity:0.4; font-size:13px; font-weight:700;" onclick="openModal('${post.id}')">üí¨ –û–¢–í–ï–¢–ò–¢–¨</div>
            </div>`;
        
        replies.filter(r => r.parent_id === post.id).forEach(reply => {
            const replyContent = linkify(reply.content);
            const rEl = document.createElement('div');
            rEl.className = 'reply-card';
            rEl.innerHTML = `<div style="color:var(--accent); font-weight:800; font-size:12px; margin-bottom:4px;">@${reply.username}</div><div style="font-size:14px; opacity:0.8;">${replyContent}</div>`;
            container.appendChild(rEl);
        });
        feed.appendChild(container);
    });
}
</script>
