<script>
// –í —Ñ—É–Ω–∫—Ü–∏—é render –¥–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É —É–¥–∞–ª–µ–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫–∏
function render(data) {
    const feed = document.getElementById('feed');
    feed.innerHTML = '';
    
    const mains = data.filter(p => !p.parent_id);
    let display = curTab === 'my' ? mains.filter(p => p.user_id === myId) : mains;

    display.forEach((p, i) => {
        const isPrem = PREMIUM_USERS.includes(p.user_id);
        const isMyPost = p.user_id === myId; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
        const div = document.createElement('div');
        div.className = 'post-wrap';
        
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–∞–±–ª: —Ç–µ–ø–µ—Ä—å —á–µ—Ä–µ–∑ Telegram API
        let bubbleHtml = '';
        if(p.track_url) {
            const username = p.track_url.split('/').pop().replace('@', '');
            const avatarUrl = `https://t.me/i/userpic/320/${username}.jpg`;
            bubbleHtml = `
                <div class="link-bubble" onclick="tg.openTelegramLink('${p.track_url}')">
                    <img src="${avatarUrl}" onerror="this.src='https://ui-avatars.com/api/?name=TG&background=0a84ff&color=fff'" class="chan-avatar">
                    <div style="flex:1">
                        <div style="font-size:14px; color:#fff; font-weight:700;">@${username}</div>
                        <div style="font-size:11px; color:var(--accent);">–û—Ç–∫—Ä—ã—Ç—å –∫–∞–Ω–∞–ª</div>
                    </div>
                </div>`;
        }
        
        let html = `
            <div class="card ${isPrem ? 'premium-card' : ''}">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <div style="font-weight:800; color:${isPrem ? 'var(--gold)' : 'var(--accent)'}; font-size:15px;">@${p.username}</div>
                    ${isMyPost ? `<div onclick="deletePost('${p.id}')" style="cursor:pointer; opacity:0.5; font-size:18px;">üóë</div>` : ''}
                </div>
                <div style="font-size:16px; line-height:1.5;">${p.content}</div>
                ${p.image_url ? `<img src="${p.image_url}" style="width:100%; border-radius:20px; margin-top:15px; display:block;">` : ''}
                ${bubbleHtml}
                <div style="margin-top:18px; opacity:0.4; font-size:12px; font-weight:900;" onclick="openModal('${p.id}')">–û–¢–í–ï–¢–ò–¢–¨</div>
            </div>`;

        // ... (–æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–æ–π –∂–µ) ...
        const reps = data.filter(r => r.parent_id === p.id);
        if (reps.length > 0) {
            html += `<div class="re-box">`;
            reps.forEach(r => {
                html += `<div class="re-item">
                    <div style="display:flex; justify-content:space-between;">
                        <b style="color:var(--accent)">@${r.username}</b>
                        ${r.user_id === myId ? `<span onclick="deletePost('${r.id}')" style="opacity:0.3;">‚úï</span>` : ''}
                    </div>
                    <div>${r.content}</div>
                </div>`;
            });
            html += `</div>`;
        }

        div.innerHTML = html;
        feed.appendChild(div);
        setTimeout(() => div.classList.add('revealed'), i * 60);
    });
}

// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –£–î–ê–õ–ï–ù–ò–Ø
async function deletePost(id) {
    if(!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?")) return;
    
    // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –æ—Ç–≤–µ—Ç—ã, –µ—Å–ª–∏ —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –ø–æ—Å—Ç
    await db.from('posts').delete().eq('parent_id', id);
    // –ó–∞—Ç–µ–º —Å–∞–º –ø–æ—Å—Ç
    const { error } = await db.from('posts').delete().eq('id', id);
    
    if(error) alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: " + error.message);
    else {
        tg.HapticFeedback.notificationOccurred('success');
        load(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ª–µ–Ω—Ç—É
    }
}

// ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ send –∏ window.onload) ...
</script>
